Sub stock()
' create a variable to hold the counter


    Dim i As Long
    Dim j As Long
    
    'set a initial variable for holding the ticker
    Dim ticker As String
    Dim ws As Worksheet

    Dim greatestincreaseticker As String
    Dim greatestdecreaseticker As String
    Dim greatestincrease As Double
    Dim greatestdecrease As Double
    Dim greatestvolumeticker As String
    Dim greatestvolume As Double
    
    'declare the values to the variables
    
    greatestincrease = 0
    greatestdecrease = 0
    greatestvolume = 0
    
    'loop through all sheets
    
    For Each ws In Worksheets
        Dim lastrow As Long
        
    'use last row variable to count the number of rows
        lastrow = ws.Cells(Rows.Count, 1).End(xlUp).Row
    
        ws.Cells(1, 11).Value = "Ticker"
        ws.Cells(1, 12).Value = "Quarterly Change"
        ws.Cells(1, 13).Value = "Percent Change"
        ws.Cells(1, 14).Value = "Total Stock Volume"
        
        'results from row 2
        j = 2
       
        
        'declare the variables
        
         Dim openprice As Double
         Dim closeprice As Double
         Dim quarterlychange As Double
         Dim totalvolume As Double
         
        'assign the value
         totalvolume = 0
         openprice = ws.Cells(2, 3).Value
         
        'loop through each row
        For i = 2 To lastrow
        
            'find the total volume
            
             totalvolume = totalvolume + ws.Cells(i, 7).Value
             
            'check if we are within the same ticker,if we are not then
             If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then
        
                 ticker = ws.Cells(i, 1).Value
                 
                'print the values
                
                 ws.Cells(j, 11).Value = ticker
                 
                 'Quarterly change
                 
                 closeprice = ws.Cells(i, 6).Value
                
                 'find the quarterly change
                 
                 quarterlychange = closeprice - openprice
                 
                 'print the result
                 
                 ws.Cells(j, 12).Value = quarterlychange
                 
                 'assign the conditional formatting
                 If quarterlychange > 0 Then
                 
                    ws.Cells(j, 12).Interior.ColorIndex = 4
                    
                 ElseIf quarterlychange < 0 Then
                
                    ws.Cells(j, 12).Interior.ColorIndex = 3
                 Else
                    ws.Cells(j, 12).Interior.ColorIndex = 2
                 End If
                    
                 
                 
                 'percentage change
                 'declare the variable
                 
                 Dim percentchange As Double
                 'find the percent change
                 
                 If openprice <> 0 Then
                    percentchange = (quarterlychange / openprice)
                 Else
                    percentchange = 0
                End If
                'print the result
                
                ws.Cells(j, 13).Value = FormatPercent(percentchange, 2)
                
                'assign the conditional formatting
                 If percentchange > 0 Then
                 
                    ws.Cells(j, 13).Interior.ColorIndex = 42
                    
                 ElseIf percentchange < 0 Then
                
                    ws.Cells(j, 13).Interior.ColorIndex = 3
                 Else
                    ws.Cells(j, 13).Interior.ColorIndex = 2
                 End If
                    
                 
                 
                 'total stock volume
                
                'print the total volume
                
                 ws.Cells(j, 14).Value = totalvolume
                 
                 'name the headers
                 
                ws.Range("Q1").Value = "Ticker"
                ws.Range("R1").Value = "Value"
                ws.Range("P2").Value = "Greatest % Increase"
                ws.Range("P3").Value = "Greatest % Decrease"
                ws.Range("P4").Value = "Greatest Total Volume"
                'find the values of greatest % increase
                
                If percentchange > greatestincrease Then
                    greatestincrease = percentchange
                    greatestincreaseticker = ticker
                    ws.Range("Q2") = ticker
                    ws.Range("R2") = FormatPercent(percentchange, 2)
                End If
                'find the values of greatest % decrease
                If percentchange < greatestdecrease Then
                    greatestdecrease = percentchange
                    greatestdecreaseticker = ticker
                    ws.Range("Q3") = ticker
                    ws.Range("R3") = FormatPercent(percentchange, 2)
                End If
                
                'find the greatest total volume
                
                If totalvolume > greatestvolume Then
                    greatestvolume = totalvolume
                    greatestvolumeticker = ticker
                    ws.Range("Q4") = ticker
                    ws.Range("R4") = totalvolume
                    
                End If
                
                'add 1 to the j(row)
                
                 j = j + 1
                 
                  'add 1 to the open price (row)
                  
                 openprice = ws.Cells(i + 1, 3).Value
                 
                'reset the total volume
                
                 totalvolume = 0
                 
                 
             End If
        Next i
        
      
    Next ws



End Sub
